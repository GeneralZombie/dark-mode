!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("DarkMode",[],t):"object"==typeof exports?exports.DarkMode=t():e.DarkMode=t()}(window,(function(){return(()=>{"use strict";var e={979:(e,t,n)=>{function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}n.d(t,{default:()=>u});var d="dark",c="light",l="dark-mode",h={container:"body",darkModeClassName:"dark-mode-active",lightModeClassName:null,defaultDarkMode:!1,remember:!0,usePrefersColorScheme:!0,widgetContainer:"body",widgetClassName:"dark-mode-widget",useStyle:!0,widgetBackgroundLight:"#aaa",widgetBackgroundDark:"#000",widgetToggleLight:"#fff",widgetToggleDark:"#fff",widgetSize:3,widgetTransitionDuration:"0.1s",hideWidget:!1,ariaLabelText:"Toggle Dark Mode"};const u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.options=i(i({},h),t),this.containerElement=document.querySelector(this.options.container),this.containerElement||(this.containerElement=document.getElementsByTagName("body")),this.mode=this._getInitialMode(),this.options.hideWidget||(this.options.useStyle&&this._addStyle(),this._createWidget(document.querySelector(this.options.widgetContainer)),this._addEventListener()),this.setMode(this.mode)}var t,n;return t=e,(n=[{key:"on",value:function(){this.setMode(d)}},{key:"off",value:function(){this.setMode(c)}},{key:"setMode",value:function(e){if(!this._modeIsValid(e))throw new Error('Invalid mode provided! Must be either "light" or "dark"');this.options.hideWidget||(this.inputElement.checked=e===d),this._handleModeChange(e)}},{key:"getMode",value:function(){return this.mode}},{key:"toggle",value:function(){if(this.options.hideWidget)this.mode===c?this._handleModeChange(d):this._handleModeChange(c);else{this.inputElement.checked=!this.inputElement.checked;var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),this.inputElement.dispatchEvent(e)}}},{key:"_handleModeChange",value:function(e){this.mode=e,e===d&&(this.options.lightModeClassName&&this.containerElement.classList.remove(this.options.lightModeClassName),this.options.darkModeClassName&&this.containerElement.classList.add(this.options.darkModeClassName)),e===c&&(this.options.darkModeClassName&&this.containerElement.classList.remove(this.options.darkModeClassName),this.options.lightModeClassName&&this.containerElement.classList.add(this.options.lightModeClassName)),this.options.remember&&this._saveModeToLocalStorage(e),this._triggerModeChangedEvent(e)}},{key:"_triggerModeChangedEvent",value:function(e){var t=new CustomEvent("darkModeChanged",{detail:{darkMode:e===d}});this.containerElement.dispatchEvent(t)}},{key:"_getInitialMode",value:function(){var e=this._loadModeFromLocalStorage();if(this._modeIsValid(e))return e;if(this.options.usePrefersColorScheme){if(window.matchMedia("(prefers-color-scheme: dark)").matches)return d;if(window.matchMedia("(prefers-color-scheme: light)").matches)return c}return this.options.defaultDarkMode?d:c}},{key:"_modeIsValid",value:function(e){return e===c||e===d}},{key:"_addEventListener",value:function(){var e=this;this.inputElement.addEventListener("change",(function(t){e._handleModeChange(t.target.checked?d:c)}))}},{key:"_createWidget",value:function(e){e||(e=document.getElementsByTagName("body"));var t=document.createElement("span");t.classList.add(this.options.widgetClassName),this.inputElement=document.createElement("input"),this.inputElement.type="checkbox";var n=this._uniqid("dark-mode-widget-input-");this.inputElement.id=n,this.inputElement.checked=this.mode===d;var o=document.createElement("label");o.setAttribute("for",n),o.setAttribute("aria-label",this.options.ariaLabelText),o.innerHTML=this.options.ariaLabelText,t.append(this.inputElement),t.append(o),e.prepend(t)}},{key:"_saveModeToLocalStorage",value:function(e){this.options.remember&&this._modeIsValid(e)&&e!==window.localStorage.getItem(l)&&window.localStorage.setItem(l,e)}},{key:"_loadModeFromLocalStorage",value:function(){return this.options.remember?window.localStorage.getItem(l):null}},{key:"_addStyle",value:function(){var e=this.options.widgetSize,t=this.options.widgetSize/2,n="\n            .".concat(this.options.widgetClassName," input[type=checkbox] {\n                height: 0;\n                width: 0;\n                display: none;\n            }\n            .").concat(this.options.widgetClassName," input[type=checkbox] + label {\n                background: ").concat(this.options.widgetBackgroundLight,";\n                transition: ").concat(this.options.widgetTransitionDuration,";\n                cursor: pointer;\n                text-indent: -9999px;\n                width: ").concat(e+"rem",";\n                height: ").concat(t+"rem",";\n                border-radius: ").concat(e+"rem",";\n                display: block;\n                position: relative;\n            }\n            .").concat(this.options.widgetClassName," input[type=checkbox] + label:after {\n                background: ").concat(this.options.widgetToggleLight,";\n                transition: ").concat(this.options.widgetTransitionDuration,";\n                content: '';\n                position: absolute;\n                top: ").concat(.05*t+"rem",";\n                left: ").concat(.05*t+"rem",";\n                width: ").concat(.9*t+"rem",";\n                height: ").concat(.9*t+"rem",";\n                border-radius: ").concat(.9*t+"rem","\n            }\n            .").concat(this.options.widgetClassName," input[type=checkbox] + label:after:active {\n                width:  ").concat(.65*e+"rem","\n            }\n            .").concat(this.options.widgetClassName," input[type=checkbox]:checked + label {\n                background: ").concat(this.options.widgetBackgroundDark,";\n            }\n            .").concat(this.options.widgetClassName," input[type=checkbox]:checked + label:after {\n                background: ").concat(this.options.widgetToggleDark,";\n                left: calc(100% - 0.075rem);\n                transform: translateX(-100%);\n            }\n        "),o=document.createElement("style");o.innerHTML=n,document.head.appendChild(o)}},{key:"_uniqid",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Date.now()/1e3,o=n.toString(16).split(".").join("");o.length<14;)o+="0";var i="";return t&&(i=".",i+=Math.round(1e8*Math.random())),e+o+i}}])&&s(t.prototype,n),e}()}},t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={exports:{}};return e[o](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n(979)})().default}));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9EYXJrTW9kZS93ZWJwYWNrL3VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24iLCJ3ZWJwYWNrOi8vRGFya01vZGUvLi9zcmMvZGFyay1tb2RlLmpzIiwid2VicGFjazovL0RhcmtNb2RlL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0RhcmtNb2RlL3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9EYXJrTW9kZS93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vRGFya01vZGUvd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCJdLCJuYW1lcyI6WyJyb290IiwiZmFjdG9yeSIsImV4cG9ydHMiLCJtb2R1bGUiLCJkZWZpbmUiLCJhbWQiLCJ3aW5kb3ciLCJEQVJLX01PREUiLCJMSUdIVF9NT0RFIiwiTE9DQUxfU1RPUkFHRV9LRVkiLCJEZWZhdWx0T3B0aW9ucyIsImNvbnRhaW5lciIsImRhcmtNb2RlQ2xhc3NOYW1lIiwibGlnaHRNb2RlQ2xhc3NOYW1lIiwiZGVmYXVsdERhcmtNb2RlIiwicmVtZW1iZXIiLCJ1c2VQcmVmZXJzQ29sb3JTY2hlbWUiLCJ3aWRnZXRDb250YWluZXIiLCJ3aWRnZXRDbGFzc05hbWUiLCJ1c2VTdHlsZSIsIndpZGdldEJhY2tncm91bmRMaWdodCIsIndpZGdldEJhY2tncm91bmREYXJrIiwid2lkZ2V0VG9nZ2xlTGlnaHQiLCJ3aWRnZXRUb2dnbGVEYXJrIiwid2lkZ2V0U2l6ZSIsIndpZGdldFRyYW5zaXRpb25EdXJhdGlvbiIsImhpZGVXaWRnZXQiLCJhcmlhTGFiZWxUZXh0Iiwib3B0aW9ucyIsInRoaXMiLCJjb250YWluZXJFbGVtZW50IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJtb2RlIiwiX2dldEluaXRpYWxNb2RlIiwiX2FkZFN0eWxlIiwiX2NyZWF0ZVdpZGdldCIsIl9hZGRFdmVudExpc3RlbmVyIiwic2V0TW9kZSIsIl9tb2RlSXNWYWxpZCIsIkVycm9yIiwiaW5wdXRFbGVtZW50IiwiY2hlY2tlZCIsIl9oYW5kbGVNb2RlQ2hhbmdlIiwiZXZlbnQiLCJjcmVhdGVFdmVudCIsImluaXRFdmVudCIsImRpc3BhdGNoRXZlbnQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJhZGQiLCJfc2F2ZU1vZGVUb0xvY2FsU3RvcmFnZSIsIl90cmlnZ2VyTW9kZUNoYW5nZWRFdmVudCIsIkN1c3RvbUV2ZW50IiwiZGV0YWlsIiwiZGFya01vZGUiLCJfbG9hZE1vZGVGcm9tTG9jYWxTdG9yYWdlIiwibWF0Y2hNZWRpYSIsIm1hdGNoZXMiLCJhZGRFdmVudExpc3RlbmVyIiwidGFyZ2V0IiwiZWxlbWVudCIsIndyYXBwZXJFbGVtZW50IiwiY3JlYXRlRWxlbWVudCIsInR5cGUiLCJpbnB1dElkIiwiX3VuaXFpZCIsImlkIiwibGFiZWxFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiaW5uZXJIVE1MIiwiYXBwZW5kIiwicHJlcGVuZCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJzZXRJdGVtIiwid2lkdGgiLCJoZWlnaHQiLCJjc3MiLCJzdHlsZUVsZW1lbnQiLCJoZWFkIiwiYXBwZW5kQ2hpbGQiLCJhIiwiYiIsImMiLCJEYXRlIiwibm93IiwiZCIsInRvU3RyaW5nIiwic3BsaXQiLCJqb2luIiwibGVuZ3RoIiwiZSIsIk1hdGgiLCJyb3VuZCIsInJhbmRvbSIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsIl9fd2VicGFja19tb2R1bGVzX18iLCJkZWZpbml0aW9uIiwia2V5IiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsIm9iaiIsInByb3AiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiXSwibWFwcGluZ3MiOiJDQUFBLFNBQTJDQSxFQUFNQyxHQUMxQixpQkFB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SyxFQUFJSyxPLHdCQ3JRbkJJLEVBQTJCLEdBRy9CLFNBQVNDLEVBQW9CQyxHQUU1QixHQUFHRixFQUF5QkUsR0FDM0IsT0FBT0YsRUFBeUJFLEdBQVVqRyxRQUczQyxJQUFJQyxFQUFTOEYsRUFBeUJFLEdBQVksQ0FHakRqRyxRQUFTLElBT1YsT0FIQWtHLEVBQW9CRCxHQUFVaEcsRUFBUUEsRUFBT0QsUUFBU2dHLEdBRy9DL0YsRUFBT0QsUUNqQmYsT0NGQWdHLEVBQW9CVixFQUFJLENBQUN0RixFQUFTbUcsS0FDakMsSUFBSSxJQUFJQyxLQUFPRCxFQUNYSCxFQUFvQkssRUFBRUYsRUFBWUMsS0FBU0osRUFBb0JLLEVBQUVyRyxFQUFTb0csSUFDNUVFLE9BQU9DLGVBQWV2RyxFQUFTb0csRUFBSyxDQUFFSSxZQUFZLEVBQU1DLElBQUtOLEVBQVdDLE1DSjNFSixFQUFvQkssRUFBSSxDQUFDSyxFQUFLQyxJQUFTTCxPQUFPTSxVQUFVQyxlQUFlQyxLQUFLSixFQUFLQyxHRkcxRVgsRUFBb0IsTSIsImZpbGUiOiJkYXJrLW1vZGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShcIkRhcmtNb2RlXCIsIFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIkRhcmtNb2RlXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIkRhcmtNb2RlXCJdID0gZmFjdG9yeSgpO1xufSkod2luZG93LCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCJjb25zdCBEQVJLX01PREUgPSAnZGFyaydcbmNvbnN0IExJR0hUX01PREUgPSAnbGlnaHQnXG5cbmNvbnN0IExPQ0FMX1NUT1JBR0VfS0VZID0gJ2RhcmstbW9kZSc7XG5cbmNvbnN0IERlZmF1bHRPcHRpb25zID0ge1xuICAgIGNvbnRhaW5lcjogJ2JvZHknLFxuICAgIGRhcmtNb2RlQ2xhc3NOYW1lOiAnZGFyay1tb2RlLWFjdGl2ZScsXG4gICAgbGlnaHRNb2RlQ2xhc3NOYW1lOiBudWxsLFxuICAgIGRlZmF1bHREYXJrTW9kZTogZmFsc2UsXG4gICAgcmVtZW1iZXI6IHRydWUsXG4gICAgdXNlUHJlZmVyc0NvbG9yU2NoZW1lOiB0cnVlLFxuICAgIHdpZGdldENvbnRhaW5lcjogJ2JvZHknLFxuICAgIHdpZGdldENsYXNzTmFtZTogJ2RhcmstbW9kZS13aWRnZXQnLFxuICAgIHVzZVN0eWxlOiB0cnVlLFxuICAgIHdpZGdldEJhY2tncm91bmRMaWdodDogJyNhYWEnLFxuICAgIHdpZGdldEJhY2tncm91bmREYXJrOiAnIzAwMCcsXG4gICAgd2lkZ2V0VG9nZ2xlTGlnaHQ6ICcjZmZmJyxcbiAgICB3aWRnZXRUb2dnbGVEYXJrOiAnI2ZmZicsXG4gICAgd2lkZ2V0U2l6ZTogMyxcbiAgICB3aWRnZXRUcmFuc2l0aW9uRHVyYXRpb246ICcwLjFzJyxcbiAgICBoaWRlV2lkZ2V0OiBmYWxzZSxcbiAgICBhcmlhTGFiZWxUZXh0OiAnVG9nZ2xlIERhcmsgTW9kZSdcbn1cblxuY2xhc3MgRGFya01vZGUge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMgPSB7fSkge1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICAuLi5EZWZhdWx0T3B0aW9ucyxcbiAgICAgICAgICAgIC4uLm9wdGlvbnNcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLmNvbnRhaW5lcik7XG4gICAgICAgIGlmICghdGhpcy5jb250YWluZXJFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lckVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tb2RlID0gdGhpcy5fZ2V0SW5pdGlhbE1vZGUoKTtcblxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5oaWRlV2lkZ2V0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLnVzZVN0eWxlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYWRkU3R5bGUoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlV2lkZ2V0KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5vcHRpb25zLndpZGdldENvbnRhaW5lcikpO1xuXG4gICAgICAgICAgICB0aGlzLl9hZGRFdmVudExpc3RlbmVyKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnNldE1vZGUodGhpcy5tb2RlKTtcbiAgICB9XG5cbiAgICBvbigpIHtcbiAgICAgICAgdGhpcy5zZXRNb2RlKERBUktfTU9ERSk7XG4gICAgfVxuXG4gICAgb2ZmKCkge1xuICAgICAgICB0aGlzLnNldE1vZGUoTElHSFRfTU9ERSk7XG4gICAgfVxuXG4gICAgc2V0TW9kZShtb2RlKSB7XG4gICAgICAgIGlmICghdGhpcy5fbW9kZUlzVmFsaWQobW9kZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBtb2RlIHByb3ZpZGVkISBNdXN0IGJlIGVpdGhlciBcIicgKyBMSUdIVF9NT0RFICsgJ1wiIG9yIFwiJyArIERBUktfTU9ERSArICdcIicpXG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5oaWRlV2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5jaGVja2VkID0gKG1vZGUgPT09IERBUktfTU9ERSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9oYW5kbGVNb2RlQ2hhbmdlKG1vZGUpO1xuICAgIH1cblxuICAgIGdldE1vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1vZGU7XG4gICAgfVxuXG4gICAgdG9nZ2xlKCkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5oaWRlV2lkZ2V0KSB7XG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5jaGVja2VkID0gIXRoaXMuaW5wdXRFbGVtZW50LmNoZWNrZWQ7XG5cbiAgICAgICAgICAgIGNvbnN0IGV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJIVE1MRXZlbnRzXCIpO1xuICAgICAgICAgICAgZXZlbnQuaW5pdEV2ZW50KCdjaGFuZ2UnLCBmYWxzZSwgdHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gTElHSFRfTU9ERSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZU1vZGVDaGFuZ2UoREFSS19NT0RFKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGFuZGxlTW9kZUNoYW5nZShMSUdIVF9NT0RFKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2hhbmRsZU1vZGVDaGFuZ2UobW9kZSkge1xuICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xuXG4gICAgICAgIGlmIChtb2RlID09PSBEQVJLX01PREUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGlnaHRNb2RlQ2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmxpZ2h0TW9kZUNsYXNzTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRhcmtNb2RlQ2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5vcHRpb25zLmRhcmtNb2RlQ2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2RlID09PSBMSUdIVF9NT0RFKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRhcmtNb2RlQ2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUodGhpcy5vcHRpb25zLmRhcmtNb2RlQ2xhc3NOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMubGlnaHRNb2RlQ2xhc3NOYW1lKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250YWluZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5vcHRpb25zLmxpZ2h0TW9kZUNsYXNzTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLnJlbWVtYmVyKSB7XG4gICAgICAgICAgICB0aGlzLl9zYXZlTW9kZVRvTG9jYWxTdG9yYWdlKG1vZGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fdHJpZ2dlck1vZGVDaGFuZ2VkRXZlbnQobW9kZSk7XG4gICAgfVxuXG4gICAgX3RyaWdnZXJNb2RlQ2hhbmdlZEV2ZW50KG1vZGUpIHtcbiAgICAgICAgY29uc3QgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ2RhcmtNb2RlQ2hhbmdlZCcsIHtkZXRhaWw6IHtkYXJrTW9kZTogbW9kZSA9PT0gREFSS19NT0RFfX0pXG4gICAgICAgIHRoaXMuY29udGFpbmVyRWxlbWVudC5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICB9XG5cbiAgICBfZ2V0SW5pdGlhbE1vZGUoKSB7XG4gICAgICAgIGNvbnN0IG1vZGUgPSB0aGlzLl9sb2FkTW9kZUZyb21Mb2NhbFN0b3JhZ2UoKTtcblxuICAgICAgICBpZiAodGhpcy5fbW9kZUlzVmFsaWQobW9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBtb2RlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51c2VQcmVmZXJzQ29sb3JTY2hlbWUpIHtcbiAgICAgICAgICAgIGlmICh3aW5kb3cubWF0Y2hNZWRpYSgnKHByZWZlcnMtY29sb3Itc2NoZW1lOiBkYXJrKScpLm1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gREFSS19NT0RFO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHdpbmRvdy5tYXRjaE1lZGlhKCcocHJlZmVycy1jb2xvci1zY2hlbWU6IGxpZ2h0KScpLm1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gTElHSFRfTU9ERTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGVmYXVsdERhcmtNb2RlKSB7XG4gICAgICAgICAgICByZXR1cm4gREFSS19NT0RFO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIExJR0hUX01PREU7XG4gICAgfVxuXG4gICAgX21vZGVJc1ZhbGlkKG1vZGUpIHtcbiAgICAgICAgcmV0dXJuIG1vZGUgPT09IExJR0hUX01PREUgfHwgbW9kZSA9PT0gREFSS19NT0RFO1xuICAgIH1cblxuICAgIF9hZGRFdmVudExpc3RlbmVyKCkge1xuICAgICAgICB0aGlzLmlucHV0RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMuX2hhbmRsZU1vZGVDaGFuZ2UoZXZlbnQudGFyZ2V0LmNoZWNrZWQgPyBEQVJLX01PREUgOiBMSUdIVF9NT0RFKTtcbiAgICAgICAgfSlcbiAgICB9XG5cbiAgICBfY3JlYXRlV2lkZ2V0KGVsZW1lbnQpIHtcbiAgICAgICAgaWYgKCFlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdyYXBwZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICB3cmFwcGVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMub3B0aW9ucy53aWRnZXRDbGFzc05hbWUpO1xuXG4gICAgICAgIHRoaXMuaW5wdXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQudHlwZSA9ICdjaGVja2JveCc7XG4gICAgICAgIGNvbnN0IGlucHV0SWQgPSB0aGlzLl91bmlxaWQoJ2RhcmstbW9kZS13aWRnZXQtaW5wdXQtJyk7XG4gICAgICAgIHRoaXMuaW5wdXRFbGVtZW50LmlkID0gaW5wdXRJZDtcbiAgICAgICAgdGhpcy5pbnB1dEVsZW1lbnQuY2hlY2tlZCA9ICh0aGlzLm1vZGUgPT09IERBUktfTU9ERSk7XG5cbiAgICAgICAgY29uc3QgbGFiZWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICAgICAgbGFiZWxFbGVtZW50LnNldEF0dHJpYnV0ZSgnZm9yJywgaW5wdXRJZCk7XG4gICAgICAgIGxhYmVsRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCB0aGlzLm9wdGlvbnMuYXJpYUxhYmVsVGV4dCk7XG4gICAgICAgIGxhYmVsRWxlbWVudC5pbm5lckhUTUwgPSB0aGlzLm9wdGlvbnMuYXJpYUxhYmVsVGV4dDtcblxuICAgICAgICB3cmFwcGVyRWxlbWVudC5hcHBlbmQodGhpcy5pbnB1dEVsZW1lbnQpO1xuICAgICAgICB3cmFwcGVyRWxlbWVudC5hcHBlbmQobGFiZWxFbGVtZW50KTtcblxuICAgICAgICBlbGVtZW50LnByZXBlbmQod3JhcHBlckVsZW1lbnQpO1xuICAgIH1cblxuICAgIF9zYXZlTW9kZVRvTG9jYWxTdG9yYWdlKG1vZGUpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucmVtZW1iZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLl9tb2RlSXNWYWxpZChtb2RlKSAmJiBtb2RlICE9PSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oTE9DQUxfU1RPUkFHRV9LRVkpKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oTE9DQUxfU1RPUkFHRV9LRVksIG1vZGUpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgX2xvYWRNb2RlRnJvbUxvY2FsU3RvcmFnZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMucmVtZW1iZXIpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShMT0NBTF9TVE9SQUdFX0tFWSk7XG4gICAgfVxuXG4gICAgX2FkZFN0eWxlKCkge1xuICAgICAgICBjb25zdCB3aWR0aCA9IHRoaXMub3B0aW9ucy53aWRnZXRTaXplO1xuICAgICAgICBjb25zdCBoZWlnaHQgPSB0aGlzLm9wdGlvbnMud2lkZ2V0U2l6ZSAvIDI7XG5cbiAgICAgICAgY29uc3QgY3NzID0gYFxuICAgICAgICAgICAgLiR7dGhpcy5vcHRpb25zLndpZGdldENsYXNzTmFtZX0gaW5wdXRbdHlwZT1jaGVja2JveF0ge1xuICAgICAgICAgICAgICAgIGhlaWdodDogMDtcbiAgICAgICAgICAgICAgICB3aWR0aDogMDtcbiAgICAgICAgICAgICAgICBkaXNwbGF5OiBub25lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLiR7dGhpcy5vcHRpb25zLndpZGdldENsYXNzTmFtZX0gaW5wdXRbdHlwZT1jaGVja2JveF0gKyBsYWJlbCB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJHt0aGlzLm9wdGlvbnMud2lkZ2V0QmFja2dyb3VuZExpZ2h0fTtcbiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiAke3RoaXMub3B0aW9ucy53aWRnZXRUcmFuc2l0aW9uRHVyYXRpb259O1xuICAgICAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjtcbiAgICAgICAgICAgICAgICB0ZXh0LWluZGVudDogLTk5OTlweDtcbiAgICAgICAgICAgICAgICB3aWR0aDogJHt3aWR0aCArICdyZW0nfTtcbiAgICAgICAgICAgICAgICBoZWlnaHQ6ICR7aGVpZ2h0ICsgJ3JlbSd9O1xuICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6ICR7d2lkdGggKyAncmVtJ307XG4gICAgICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLiR7dGhpcy5vcHRpb25zLndpZGdldENsYXNzTmFtZX0gaW5wdXRbdHlwZT1jaGVja2JveF0gKyBsYWJlbDphZnRlciB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJHt0aGlzLm9wdGlvbnMud2lkZ2V0VG9nZ2xlTGlnaHR9O1xuICAgICAgICAgICAgICAgIHRyYW5zaXRpb246ICR7dGhpcy5vcHRpb25zLndpZGdldFRyYW5zaXRpb25EdXJhdGlvbn07XG4gICAgICAgICAgICAgICAgY29udGVudDogJyc7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IGFic29sdXRlO1xuICAgICAgICAgICAgICAgIHRvcDogJHsoaGVpZ2h0ICogMC4wNSkgKyAncmVtJ307XG4gICAgICAgICAgICAgICAgbGVmdDogJHsoaGVpZ2h0ICogMC4wNSkgKyAncmVtJ307XG4gICAgICAgICAgICAgICAgd2lkdGg6ICR7KGhlaWdodCAqIDAuOSkgKyAncmVtJ307XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAkeyhoZWlnaHQgKiAwLjkpICsgJ3JlbSd9O1xuICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6ICR7KGhlaWdodCAqIDAuOSkgKyAncmVtJ31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC4ke3RoaXMub3B0aW9ucy53aWRnZXRDbGFzc05hbWV9IGlucHV0W3R5cGU9Y2hlY2tib3hdICsgbGFiZWw6YWZ0ZXI6YWN0aXZlIHtcbiAgICAgICAgICAgICAgICB3aWR0aDogICR7KHdpZHRoICogMC42NSkgKyAncmVtJ31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC4ke3RoaXMub3B0aW9ucy53aWRnZXRDbGFzc05hbWV9IGlucHV0W3R5cGU9Y2hlY2tib3hdOmNoZWNrZWQgKyBsYWJlbCB7XG4gICAgICAgICAgICAgICAgYmFja2dyb3VuZDogJHt0aGlzLm9wdGlvbnMud2lkZ2V0QmFja2dyb3VuZERhcmt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLiR7dGhpcy5vcHRpb25zLndpZGdldENsYXNzTmFtZX0gaW5wdXRbdHlwZT1jaGVja2JveF06Y2hlY2tlZCArIGxhYmVsOmFmdGVyIHtcbiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAke3RoaXMub3B0aW9ucy53aWRnZXRUb2dnbGVEYXJrfTtcbiAgICAgICAgICAgICAgICBsZWZ0OiBjYWxjKDEwMCUgLSAwLjA3NXJlbSk7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMDAlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgYDtcblxuICAgICAgICBjb25zdCBzdHlsZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuICAgICAgICBzdHlsZUVsZW1lbnQuaW5uZXJIVE1MID0gY3NzO1xuXG4gICAgICAgIGRvY3VtZW50LmhlYWQuYXBwZW5kQ2hpbGQoc3R5bGVFbGVtZW50KTtcbiAgICB9XG5cbiAgICBfdW5pcWlkKGEgPSAnJywgYiA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IGMgPSBEYXRlLm5vdygpIC8gMTAwMDtcbiAgICAgICAgbGV0IGQgPSBjLnRvU3RyaW5nKDE2KS5zcGxpdChcIi5cIikuam9pbihcIlwiKTtcbiAgICAgICAgd2hpbGUgKGQubGVuZ3RoIDwgMTQpIGQgKz0gXCIwXCI7XG4gICAgICAgIGxldCBlID0gXCJcIjtcbiAgICAgICAgaWYgKGIpIHtcbiAgICAgICAgICAgIGUgPSBcIi5cIjtcbiAgICAgICAgICAgIGUgKz0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYSArIGQgKyBlO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRGFya01vZGU7IiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0aWYoX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSkge1xuXHRcdHJldHVybiBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCIvLyBtb2R1bGUgZXhwb3J0cyBtdXN0IGJlIHJldHVybmVkIGZyb20gcnVudGltZSBzbyBlbnRyeSBpbmxpbmluZyBpcyBkaXNhYmxlZFxuLy8gc3RhcnR1cFxuLy8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG5yZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyg5NzkpO1xuIiwiLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0c1xuX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHtcblx0Zm9yKHZhciBrZXkgaW4gZGVmaW5pdGlvbikge1xuXHRcdGlmKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkge1xuXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTtcblx0XHR9XG5cdH1cbn07IiwiX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCkiXSwic291cmNlUm9vdCI6IiJ9